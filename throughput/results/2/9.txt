BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%slate%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 260952548.059792
 ALGERIA                   |   1997 | 449881913.392611
 ALGERIA                   |   1996 | 451715157.415572
 ALGERIA                   |   1995 | 445602450.947651
 ALGERIA                   |   1994 | 455648099.652179
 ALGERIA                   |   1993 | 443775047.178982
 ALGERIA                   |   1992 | 451865733.877479
 ARGENTINA                 |   1998 | 278716356.919538
 ARGENTINA                 |   1997 | 470768528.799612
 ARGENTINA                 |   1996 | 465655209.039752
 ARGENTINA                 |   1995 | 469327732.168988
 ARGENTINA                 |   1994 |  472968283.63536
 ARGENTINA                 |   1993 | 463168435.971694
 ARGENTINA                 |   1992 | 468087551.732969
 BRAZIL                    |   1998 | 276384036.314186
 BRAZIL                    |   1997 | 474523028.730507
 BRAZIL                    |   1996 | 473053787.171795
 BRAZIL                    |   1995 | 469176766.369073
 BRAZIL                    |   1994 | 466736353.129382
 BRAZIL                    |   1993 | 472550279.324886
 BRAZIL                    |   1992 | 477171550.924583
 CANADA                    |   1998 | 272826971.467569
 CANADA                    |   1997 | 469227942.752228
 CANADA                    |   1996 | 469120226.604603
 CANADA                    |   1995 | 474075678.468414
 CANADA                    |   1994 | 481505303.210705
 CANADA                    |   1993 |  478491324.49138
 CANADA                    |   1992 | 471800053.535367
 CHINA                     |   1998 | 275788302.663323
 CHINA                     |   1997 | 466067987.735802
 CHINA                     |   1996 | 473436819.312513
 CHINA                     |   1995 | 465403109.405072
 CHINA                     |   1994 | 466176275.034898
 CHINA                     |   1993 | 470828056.555363
 CHINA                     |   1992 | 468251392.543203
 EGYPT                     |   1998 | 269707669.858563
 EGYPT                     |   1997 | 473480731.057137
 EGYPT                     |   1996 | 467429131.824634
 EGYPT                     |   1995 | 468578524.525336
 EGYPT                     |   1994 | 471347849.756138
 EGYPT                     |   1993 | 468750238.352431
 EGYPT                     |   1992 | 478682442.747975
 ETHIOPIA                  |   1998 | 274740646.606677
 ETHIOPIA                  |   1997 | 456568300.709641
 ETHIOPIA                  |   1996 | 451929645.480777
 ETHIOPIA                  |   1995 |  456940226.65946
 ETHIOPIA                  |   1994 | 462486477.587818
 ETHIOPIA                  |   1993 | 459536949.480425
 ETHIOPIA                  |   1992 | 460323565.745893
 FRANCE                    |   1998 | 269422589.714796
 FRANCE                    |   1997 | 460973879.876011
 FRANCE                    |   1996 | 458192408.831426
 FRANCE                    |   1995 | 462090371.951091
 FRANCE                    |   1994 | 458640332.350327
 FRANCE                    |   1993 | 462308009.312999
 FRANCE                    |   1992 | 453538637.982459
 GERMANY                   |   1998 | 282143052.793438
 GERMANY                   |   1997 | 473782853.557444
 GERMANY                   |   1996 | 477710473.439607
 GERMANY                   |   1995 | 480705940.331884
 GERMANY                   |   1994 | 475837220.957046
 GERMANY                   |   1993 | 471131189.566073
 GERMANY                   |   1992 | 471906815.110395
 INDIA                     |   1998 | 267468662.472766
 INDIA                     |   1997 | 463150192.102113
 INDIA                     |   1996 | 479714531.939362
 INDIA                     |   1995 | 478103044.058558
 INDIA                     |   1994 | 465266875.864266
 INDIA                     |   1993 | 469856401.757411
 INDIA                     |   1992 | 467241969.956995
 INDONESIA                 |   1998 | 268292266.348626
 INDONESIA                 |   1997 | 463076192.205614
 INDONESIA                 |   1996 | 474573525.337715
 INDONESIA                 |   1995 | 458467752.721004
 INDONESIA                 |   1994 | 464701047.005288
 INDONESIA                 |   1993 | 462517356.494158
 INDONESIA                 |   1992 | 460929918.106912
 IRAN                      |   1998 | 267372616.510877
 IRAN                      |   1997 |  464618018.44739
 IRAN                      |   1996 | 462023783.785496
 IRAN                      |   1995 |   462265891.1464
 IRAN                      |   1994 | 465786474.704866
 IRAN                      |   1993 | 458521296.257357
 IRAN                      |   1992 | 466935752.911307
 IRAQ                      |   1998 | 280561604.943263
 IRAQ                      |   1997 | 471951221.840008
 IRAQ                      |   1996 |  479778783.23638
 IRAQ                      |   1995 | 471065831.119312
 IRAQ                      |   1994 |  472156952.10218
 IRAQ                      |   1993 |  469650377.12326
 IRAQ                      |   1992 | 477253798.325892
 JAPAN                     |   1998 | 268101279.098545
 JAPAN                     |   1997 | 464248274.268806
 JAPAN                     |   1996 | 470735153.076021
 JAPAN                     |   1995 | 460869924.936947
 JAPAN                     |   1994 | 467221412.906849
 JAPAN                     |   1993 | 463834072.057953
 JAPAN                     |   1992 | 462723023.066901
 JORDAN                    |   1998 | 269067129.555244
 JORDAN                    |   1997 |  450394159.06578
 JORDAN                    |   1996 | 459971148.295038
 JORDAN                    |   1995 | 455466249.504143
 JORDAN                    |   1994 | 456312911.401067
 JORDAN                    |   1993 |  448363160.94262
 JORDAN                    |   1992 | 453544283.057005
 KENYA                     |   1998 | 282558311.765858
 KENYA                     |   1997 | 469886298.580371
 KENYA                     |   1996 | 479332033.239641
 KENYA                     |   1995 | 474631239.424554
 KENYA                     |   1994 | 472396213.743211
 KENYA                     |   1993 | 479660640.805494
 KENYA                     |   1992 | 470721660.584645
 MOROCCO                   |   1998 | 275073855.068202
 MOROCCO                   |   1997 |  460208760.32189
 MOROCCO                   |   1996 | 465339208.124665
 MOROCCO                   |   1995 | 469590158.155678
 MOROCCO                   |   1994 | 464160900.921126
 MOROCCO                   |   1993 | 466487740.684308
 MOROCCO                   |   1992 | 472332186.448981
 MOZAMBIQUE                |   1998 | 267092139.921294
 MOZAMBIQUE                |   1997 | 455725781.057933
 MOZAMBIQUE                |   1996 | 457757889.222245
 MOZAMBIQUE                |   1995 | 455924775.615148
 MOZAMBIQUE                |   1994 | 450418923.713023
 MOZAMBIQUE                |   1993 | 448657256.448116
 MOZAMBIQUE                |   1992 | 455495656.328964
 PERU                      |   1998 | 279726468.553756
 PERU                      |   1997 |  469809419.42892
 PERU                      |   1996 |  468087738.61551
 PERU                      |   1995 | 475240473.610516
 PERU                      |   1994 | 467234215.025138
 PERU                      |   1993 |  471916480.01329
 PERU                      |   1992 |  461486132.16791
 ROMANIA                   |   1998 | 275747946.760351
 ROMANIA                   |   1997 | 460350297.970466
 ROMANIA                   |   1996 | 466042163.148587
 ROMANIA                   |   1995 | 455154609.565199
 ROMANIA                   |   1994 | 461019055.049394
 ROMANIA                   |   1993 | 464054088.503441
 ROMANIA                   |   1992 | 467390213.036281
 RUSSIA                    |   1998 | 275213107.333979
 RUSSIA                    |   1997 | 466612166.718516
 RUSSIA                    |   1996 | 471395949.282526
 RUSSIA                    |   1995 | 464600675.627557
 RUSSIA                    |   1994 | 464119120.649845
 RUSSIA                    |   1993 | 463639427.998524
 RUSSIA                    |   1992 | 466634567.303696
 SAUDI ARABIA              |   1998 | 278241464.167453
 SAUDI ARABIA              |   1997 | 470188827.681125
 SAUDI ARABIA              |   1996 | 465108910.084229
 SAUDI ARABIA              |   1995 |  466205892.15315
 SAUDI ARABIA              |   1994 |  462980593.53643
 SAUDI ARABIA              |   1993 | 467134072.082884
 SAUDI ARABIA              |   1992 | 461193083.246478
 UNITED KINGDOM            |   1998 | 275449715.606909
 UNITED KINGDOM            |   1997 | 469929152.061969
 UNITED KINGDOM            |   1996 | 467247605.361301
 UNITED KINGDOM            |   1995 | 472013234.667031
 UNITED KINGDOM            |   1994 | 473769347.429299
 UNITED KINGDOM            |   1993 | 464669553.532558
 UNITED KINGDOM            |   1992 | 465938739.967811
 UNITED STATES             |   1998 | 275008556.174983
 UNITED STATES             |   1997 | 465526011.221222
 UNITED STATES             |   1996 | 462801637.907653
 UNITED STATES             |   1995 | 469532838.820017
 UNITED STATES             |   1994 | 469124964.351329
 UNITED STATES             |   1993 | 467386116.983741
 UNITED STATES             |   1992 | 466166824.183087
 VIETNAM                   |   1998 | 270668758.363105
 VIETNAM                   |   1997 | 474626618.121834
 VIETNAM                   |   1996 |  467042813.57743
 VIETNAM                   |   1995 | 456278607.739169
 VIETNAM                   |   1994 | 469648567.662539
 VIETNAM                   |   1993 | 473503940.400534
 VIETNAM                   |   1992 | 458978487.237576
(175 rows)

COMMIT;
COMMIT
